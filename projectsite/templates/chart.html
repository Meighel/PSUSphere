{% extends 'base.html' %}
{% load static %}
{% block content %}

<style>
    .lineChart .ct-series-a .ct-point, .ct-series-a .ct-bar {
        stroke: rgb(133, 236, 181);
    }

    .pieChart .ct-series-a .ct-point, .ct-series-a .ct-bar {
        stroke: rgb(255, 220, 23);
    }

    .radarChart .ct-series-a .ct-point, .ct-series-a .ct-bar {
        stroke: rgb(255, 209, 220);
    }

    .vennChart .ct-series-a .ct-point, .ct-series-a .ct-bar {
        stroke: rgb(135, 119, 255);
    }

    .lineChart .barChart {
        height: 400px;
        width: 600px;
        overflow: hidden;
    }

    .page-inner {
        overflow-x: hidden;
        padding-left: 20px;
        padding-top: 10%;
    }

    .col-md-9 {
        margin-top: 2%;
        margin-left: 2%;
    }
</style>

<div class="page-inner">
    <h4 class="page-title">Chart</h4>
    <div class="page-category">Simple yet flexible Javascript charting for designers & developers. Please checkout their <a href="https://www.chartjs.org/" target="_blank">full documentation</a>.</div>
    <div class="row">
        <!-- Line Chart -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><b>Line Chart:</b> Students Joined Organizations in 2024</div>
                </div>
                <div class="card-body">
                    <div class="card-container">
                        <div class="lineChart ct-perfect-fourth"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie Chart -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><b>Pie Chart:</b> Number of Students in Each Courses</div>
                </div>
                <div class="card-body">
                    <div class="card-container">
                        <div class="pieChart ct-perfect-fourth"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Radar Chart -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><b>Radar Chart:</b> Programs in Every Colleges</div>
                </div>
                <div class="card-body">
                    <div class="card-container">
                        <canvas id="radarChart" class="radarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Venn Diagram -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><b>Venn Diagram:</b> Distribution of Student Interests</div>
                </div>
                <div class="card-body">
                    <div class="card-container">
                        <canvas id="vennChart" class="vennChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Horizontal Bar Chart -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><b>Horizontal Bar Chart:</b> Organizations in a College</div>
                </div>
                <div class="card-body">
                    <div class="card-container">
                        <div class="horBarChart ct-perfect-fourth"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Line Chart
        fetch('/line-count-by-month-2024/')
            .then(response => response.json())
            .then(data => {
                new Chartist.Line('.lineChart', data, {
                    fullWidth: true,
                    chartPadding: {
                        top: 15,
                        right: 30,
                        bottom: 15,
                        left: 15
                    },
                    axisY: {
                        onlyInteger: true,
                        low: 0
                    },
                    axisX: {
                        showGrid: true
                    },
                    plugins: [
                        Chartist.plugins.tooltip()
                    ]
                });
            });

        // Pie Chart
        fetch('/pie-student-count-by-org/')
            .then(response => response.json())
            .then(data => {
                const total = data.series.reduce((sum, count) => sum + count, 0);
                const percentages = data.series.map(count => ((count / total) * 100).toFixed(1) + '%');

                const seriesWithMeta = data.series.map((value, idx) => ({
                    value: value,
                    meta: data.labels[idx]
                }));

                new Chartist.Pie('.pieChart', {
                    series: seriesWithMeta,
                    labels: percentages
                }, {
                    chartPadding: 30,
                    labelOffset: 50,
                    labelDirection: 'explode',
                    plugins: [
                        Chartist.plugins.tooltip({
                            tooltipFnc: function (meta, value) {
                                return `${meta}: ${value} students`;
                            }
                        })
                    ]
                });
            });

        // Radar Chart (Fake Data)
        fetch('/program-frequency-chart/')
        .then(response => response.json())
        .then(data => {
            // Prepare data for the radar chart
            const labels = data.colleges;  // College names
            const programCounts = data.program_counts;  // Program counts

            // Create the radar chart
            new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Programs per College',
                        data: programCounts,
                        fill: true,
                        backgroundColor: 'rgba(79, 140, 255, 0.2)', // Color of the filled area
                        borderColor: 'rgb(79, 140, 255)', // Border color of the chart
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        });

        // Venn Diagram (Fake Data using Chart.js)
        var vennCtx = document.getElementById('vennChart').getContext('2d');
        var vennChart = new Chart(vennCtx, {
            type: 'pie',
            data: {
                labels: ['Arts', 'Sports', 'Music'],
                datasets: [{
                    label: 'Student Interests',
                    data: [30, 45, 25],
                    backgroundColor: ['rgba(135, 119, 255, 0.6)', 'rgba(255, 220, 23, 0.6)', 'rgba(133, 236, 181, 0.6)']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.dataset.label + ': ' + tooltipItem.raw + ' students';
                            }
                        }
                    }
                }
            }
        });

        // Horizontal Bar Chart
        fetch('/org-count-by-college/')
            .then(response => response.json())
            .then(data => {
                new Chartist.Bar('.horBarChart', {
                    labels: data.labels,
                    series: [data.series]
                }, {
                    horizontalBars: true,
                    reverseData: true,
                    axisX: {
                        onlyInteger: true,
                    },
                    axisY: {
                        offset: 120,
                    },
                    plugins: [
                        Chartist.plugins.tooltip({
                            tooltipFnc: function (meta, value) {
                                return `${value} organization(s)`;
                            }
                        })
                    ]
                });
            });
    });
</script>

{% endblock %}
